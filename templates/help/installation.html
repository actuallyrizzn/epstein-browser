{% extends "base.html" %}

{% block title %}Installation Guide - Help & Documentation{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('help_page') }}">Help</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Installation Guide</li>
                </ol>
            </nav>
            
            <div class="card">
                <div class="card-header">
                    <h1><i class="fas fa-download me-2"></i>Installation Guide</h1>
                    <p class="mb-0 text-muted">Set up your own mirror of the Epstein Documents Browser</p>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Why run your own instance?</strong> Running your own mirror helps with decentralization, 
                        allows for custom queries, and ensures data availability even if the main site is unavailable.
                    </div>

                    <h2><i class="fas fa-server me-2"></i>System Requirements</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Minimum Requirements</h5>
                            <ul>
                                <li><strong>CPU:</strong> 2 cores, 1.5+ GHz (tested on dual-core systems)</li>
                                <li><strong>RAM:</strong> 4 GB</li>
                                <li><strong>Storage:</strong> <strong>71+ GB free space</strong> (for document data)</li>
                                <li><strong>OS:</strong> Windows 10+, macOS 10.14+, or Linux</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Recommended</h5>
                            <ul>
                                <li><strong>CPU:</strong> 4+ cores, 2.0+ GHz (for faster OCR processing)</li>
                                <li><strong>RAM:</strong> 8+ GB (for better performance with large datasets)</li>
                                <li><strong>Storage:</strong> 100+ GB SSD (71GB for data + 29GB for system/processing)</li>
                                <li><strong>Network:</strong> Stable internet connection (for initial download)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Storage Warning:</strong> The congressional documents require <strong>71 GB minimum</strong> of free space. 
                        This is the actual size of the released document collection. Plan accordingly!
                    </div>

                    <h2><i class="fas fa-code me-2"></i>Prerequisites</h2>
                    <p>Before installing, ensure you have the following software installed:</p>
                    
                    <h4>Python 3.8+</h4>
                    <div class="help-code">
                        <pre><code># Check Python version
python --version

# If not installed, download from:
# https://www.python.org/downloads/</code></pre>
                    </div>

                    <h4>Git</h4>
                    <div class="help-code">
                        <pre><code># Check Git installation
git --version

# If not installed, download from:
# https://git-scm.com/downloads</code></pre>
                    </div>

                    <h2><i class="fas fa-download me-2"></i>Installation Steps</h2>
                    
                    <h3>Step 1: Clone the Repository</h3>
                    <div class="help-code">
                        <pre><code># Clone the repository
git clone https://github.com/gopoversight/epstein-documents-browser.git
cd epstein-documents-browser</code></pre>
                    </div>

                    <h3>Step 2: Set Up Python Environment</h3>
                    <div class="help-code">
                        <pre><code># Create virtual environment
python -m venv venv

# Activate virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt</code></pre>
                    </div>

                    <h3>Step 3: Configure the Application</h3>
                    <p>Create a configuration file for your instance:</p>
                    <div class="help-code">
                        <pre><code># Create config.py
cat > config.py << EOF
import os

# Data directory (where documents will be stored)
DATA_DIR = os.path.join(os.path.dirname(__file__), 'data')

# Database file
DATABASE = 'images.db'

# Application settings
DEBUG = False
HOST = '0.0.0.0'
PORT = 5000
EOF</code></pre>
                    </div>

                    <h3>Step 4: Index the Documents</h3>
                    <p>This step scans all document images and creates the database:</p>
                    <div class="help-code">
                        <pre><code># Index all document images into the database
python index_images.py

# This will:
# - Scan the data directory for image files
# - Create images.db SQLite database
# - Process each image and extract metadata
# - Show progress as it works through the files</code></pre>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> The indexing process may take some time depending on the number of images. 
                        The script will show progress as it processes each file.
                    </div>

                    <h2><i class="fas fa-download me-2"></i>Document Setup</h2>
                    <p>This application works with local document files. You'll need to download the documents from the official sources and place them in the correct directory structure.</p>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Download Size:</strong> The complete document collection is approximately <strong>71 GB</strong>. 
                        Ensure you have sufficient storage space and a stable internet connection for the download.
                    </div>

                    <h3>Download Documents</h3>
                    <div class="help-code">
                        <pre><code># Create data directory
mkdir -p data

# Download from Google Drive (primary source)
# https://drive.google.com/drive/folders/1TrGxDGQLDLZu1vvvZDBAh-e7wN3y6Hoz
# Size: ~71 GB

# Or use Dropbox backup
# https://www.dropbox.com/scl/fo/98fthv8otekjk28lcrnc5/AIn3egnE58MYe4Bn4fliVBw
# Size: ~71 GB</code></pre>
                    </div>

                    <h3>Directory Structure</h3>
                    <p>When you download and extract the official documents, they will be organized in this structure:</p>
                    <div class="help-code">
                        <pre><code>data/
‚îî‚îÄ‚îÄ Prod 01_20250822/
    ‚îî‚îÄ‚îÄ VOL00001/
        ‚îú‚îÄ‚îÄ IMAGES/
        ‚îÇ   ‚îú‚îÄ‚îÄ IMAGES001/
        ‚îÇ   ‚îú‚îÄ‚îÄ IMAGES002/
        ‚îÇ   ‚îî‚îÄ‚îÄ ... (IMAGES003 through IMAGES012)
        ‚îî‚îÄ‚îÄ NATIVES/
            ‚îú‚îÄ‚îÄ NATIVE006/
            ‚îú‚îÄ‚îÄ NATIVE008/
            ‚îî‚îÄ‚îÄ ... (other NATIVE directories)</code></pre>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important:</strong> This is the official directory structure as released by the House Oversight Committee. 
                        <strong>Do not try to reorganize or "fix" this structure</strong> - the application is designed to work around 
                        their unconventional organization. Just extract the files as-is and let the browser handle the rest.
                    </div>

                    <h2><i class="fas fa-play me-2"></i>Running the Application</h2>
                    
                    <h3>Step 1: Index the Documents</h3>
                    <p>Before running the web application, you need to index the document images into the database:</p>
                    <div class="help-code">
                        <pre><code># Index all document images into the database
python index_images.py

# This will scan the data directory and create images.db
# Progress will be shown as it processes each image</code></pre>
                    </div>

                    <h3>Step 2: Start the Web Application</h3>
                    <div class="help-code">
                        <pre><code># Start the Flask application
python app.py

# The application will start and show:
# üöÄ Starting Epstein Documents Browser (Development)...
# üìñ Browse: http://localhost:8080
# üìä Stats: http://localhost:8080/api/stats
# üåê Accessible from: http://0.0.0.0:8080
# 
# Press Ctrl+C to stop the server</code></pre>
                    </div>

                    <h3>Environment Configuration</h3>
                    <p>The application uses environment variables for configuration. You can create a <code>.env</code> file:</p>
                    <div class="help-code">
                        <pre><code># Create .env file for configuration
cat > .env << EOF
# Data directory (where documents are stored)
DATA_DIR=data

# Database file path
DATABASE_PATH=images.db

# Flask configuration
FLASK_ENV=development
HOST=0.0.0.0
PORT=8080
DEBUG=True
EOF</code></pre>
                    </div>

                    <h3>Production Deployment</h3>
                    <p>For production, set environment variables and use a proper WSGI server:</p>
                    <div class="help-code">
                        <pre><code># Set production environment
export FLASK_ENV=production
export HOST=127.0.0.1
export PORT=8080
export DEBUG=False

# Install production WSGI server
pip install gunicorn

# Run with Gunicorn
gunicorn -w 4 -b 127.0.0.1:8080 app:app</code></pre>
                    </div>

                    <h2><i class="fas fa-cog me-2"></i>Configuration Options</h2>
                    
                    <h3>Environment Variables</h3>
                    <div class="help-code">
                        <pre><code># Application Configuration
export DATA_DIR=data                    # Directory containing document images
export DATABASE_PATH=images.db          # SQLite database file path

# Flask Configuration
export FLASK_ENV=development            # or 'production'
export HOST=0.0.0.0                    # or '127.0.0.1' for production
export PORT=8080                       # Port to run on
export DEBUG=True                      # or 'False' for production

# Optional: Secret key for sessions
export SECRET_KEY=your-secret-key-here</code></pre>
                    </div>

                    <h3>Custom Styling</h3>
                    <p>You can customize the appearance by modifying the CSS files in the <code>static/css/</code> directory or by overriding templates in the <code>templates/</code> directory.</p>

                    <h2><i class="fas fa-shield-alt me-2"></i>Security Considerations</h2>
                    <ul>
                        <li><strong>Firewall:</strong> Configure your firewall to only allow necessary ports</li>
                        <li><strong>HTTPS:</strong> Use SSL certificates for production deployments</li>
                        <li><strong>Updates:</strong> Keep the application and dependencies updated</li>
                        <li><strong>Backups:</strong> Regularly backup your database and configuration</li>
                        <li><strong>Access Control:</strong> Consider implementing authentication if needed</li>
                    </ul>

                    <h2><i class="fas fa-tools me-2"></i>Troubleshooting</h2>
                    
                    <h3>Common Issues</h3>
                    
                    <h4>Missing Dependencies</h4>
                    <div class="help-code">
                        <pre><code># Install missing packages
pip install -r requirements.txt

# Common missing packages:
# - markdown (for blog posts)
# - pytesseract (for OCR functionality)
# - Pillow (for image processing)</code></pre>
                    </div>

                    <h4>Data Directory Not Found</h4>
                    <div class="help-code">
                        <pre><code># Check if data directory exists
ls -la data/

# Create data directory if missing
mkdir -p data

# Set correct data directory
export DATA_DIR=data</code></pre>
                    </div>

                    <h4>Database Issues</h4>
                    <div class="help-code">
                        <pre><code># Check if database exists
ls -la images.db

# Recreate database by re-indexing
rm images.db
python index_images.py

# Check database permissions
chmod 644 images.db</code></pre>
                    </div>

                    <h4>Port Already in Use</h4>
                    <div class="help-code">
                        <pre><code># Windows - Check what's using port 8080
netstat -ano | findstr :8080

# Windows - Kill process using the port
taskkill /PID <PID_NUMBER> /F

# Use a different port
set PORT=8081
python app.py</code></pre>
                    </div>

                    <h4>Image Processing Errors</h4>
                    <div class="help-code">
                        <pre><code># Check if Tesseract is installed (for OCR)
tesseract --version

# Install Tesseract OCR
# Windows: Download from GitHub releases
# macOS: brew install tesseract
# Linux: sudo apt-get install tesseract-ocr</code></pre>
                    </div>

                    <h4>Indexing Problems</h4>
                    <div class="help-code">
                        <pre><code># Check indexing progress and errors
python index_images.py

# The script will show:
# - Progress as it processes images
# - Error count if any files fail
# - Summary of indexed/updated/skipped files</code></pre>
                    </div>

                    <h3>Error Messages</h3>
                    <p>Common error messages and solutions:</p>
                    <ul>
                        <li><strong>"Data directory does not exist"</strong> - Create the <code>data/</code> directory and download documents</li>
                        <li><strong>"No module named 'markdown'"</strong> - Run <code>pip install -r requirements.txt</code></li>
                        <li><strong>"Address already in use"</strong> - Port 8080 is busy, use a different port or kill the existing process</li>
                        <li><strong>"TIF conversion failed"</strong> - Image file is corrupted or unsupported format</li>
                        <li><strong>"Error reading OCR file"</strong> - OCR text file is missing or corrupted</li>
                    </ul>

                    <h3>Debugging</h3>
                    <div class="help-code">
                        <pre><code># Enable debug mode
set FLASK_ENV=development
set DEBUG=True
python app.py

# Check application output for errors
# The app will print error messages to console</code></pre>
                    </div>

                    <h3>Performance Tips</h3>
                    <ul>
                        <li><strong>Database:</strong> Keep <code>images.db</code> on fast storage (SSD recommended)</li>
                        <li><strong>Memory:</strong> 4GB+ RAM recommended for smooth operation</li>
                        <li><strong>Storage:</strong> Ensure 71GB+ free space for document data</li>
                        <li><strong>Indexing:</strong> Run indexing during off-peak hours as it's resource-intensive</li>
                    </ul>

                    <h2><i class="fas fa-question-circle me-2"></i>Getting Help</h2>
                    <p>If you encounter issues during installation or setup:</p>
                    <ul>
                        <li>Check the <a href="{{ url_for('help_usage') }}">Usage Guide</a> for common questions</li>
                        <li>Review the <a href="{{ url_for('help_api') }}">API Documentation</a> for integration details</li>
                        <li>Check the GitHub repository for issues and discussions</li>
                        <li>Ensure all prerequisites are properly installed</li>
                    </ul>

                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Success!</strong> Once installed, your instance will provide search and browsing capabilities 
                        for the local document collection.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            {% include 'help/_quick_links.html' %}
            
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-download me-2"></i>Data Sources</h5>
                </div>
                <div class="card-body">
                    <p><strong>Official Release:</strong></p>
                    <p><a href="https://oversight.house.gov/release/oversight-committee-releases-epstein-records-provided-by-the-department-of-justice/" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-landmark me-1"></i>House Oversight
                    </a></p>
                    
                    <p><strong>Document Sources:</strong></p>
                    <p><a href="https://drive.google.com/drive/folders/1TrGxDGQLDLZu1vvvZDBAh-e7wN3y6Hoz" target="_blank" class="btn btn-sm btn-outline-success">
                        <i class="fab fa-google-drive me-1"></i>Google Drive
                    </a></p>
                    
                    <p><strong>Note:</strong></p>
                    <p class="small text-muted">This browser currently works with local document files. API synchronization features are planned for future development.</p>
                    
                    <hr>
                    
                    <p class="small text-muted">
                        <a href="{{ url_for('help_context') }}">View complete official context</a> including 
                        congressional sources, subpoena details, and document access information.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.help-code {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 0.5rem 0;
}

.help-code pre {
    margin: 0;
    color: #495057;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.875rem;
    line-height: 1.4;
}

.help-code code {
    background: none;
    padding: 0;
    color: inherit;
    font-size: inherit;
}

/* Syntax highlighting for code blocks */
.help-code pre code {
    color: #2d3748;
}

/* Inline code styling */
code:not(.help-code code) {
    background-color: #e2e8f0;
    color: #2d3748;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}
</style>
{% endblock %}
